import{Q as S,I as p,ag as ae,T as X,J as se,H as ne,a as Y,b as le,M as oe,N as te,O as B,R as U,_ as Q,ah as ie,ai as fe,U as H,X as ce,V as I,aj as z,ak as de,a0 as ue,al as J,am as ve,Y as W,Z as he,an as _e,ao as x,ap as Z,aq as ke,ar as we,as as Le,at as me,au as Ce,av as Ee,e as ye,aw as $,ax as ge,u as G,ay as K,az as be,ab as pe}from"./CZg8cpZA.js";function Te(e,n,r){for(var l=e.items,o=[],a=n.length,s=0;s<a;s++)me(n[s].e,o,!0);var t=a>0&&o.length===0&&r!==null;if(t){var u=r.parentNode;Ce(u),u.append(r),l.clear(),g(e,n[0].prev,n[a-1].next)}Ee(o,()=>{for(var v=0;v<a;v++){var w=n[v];t||(l.delete(w.k),g(e,w.prev,w.next)),Z(w.e,!t)}})}function Me(e,n,r,l,o,a=null){var s=e,t={flags:n,items:new Map,first:null};{var u=e;s=p?S(ae(u)):u.appendChild(X())}p&&se();var v=null,w=!1,C=new Map,i=le(()=>{var d=r();return de(d)?d:d==null?[]:z(d)}),k,f;function c(){Re(f,k,t,C,s,o,n,l,r),a!==null&&(k.length===0?v?W(v):v=H(()=>a(s)):v!==null&&he(v,()=>{v=null}))}ne(()=>{f??=ye,k=Y(i);var d=k.length;if(w&&d===0)return;w=d===0;let T=!1;if(p){var E=oe(s)===te;E!==(d===0)&&(s=B(),S(s),U(!1),T=!0)}if(p){for(var h=null,L,_=0;_<d;_++){if(Q.nodeType===ie&&Q.data===fe){s=Q,T=!0,U(!1);break}var b=k[_],y=l(b,_);L=V(Q,t,h,null,b,y,_,o,n,r),t.items.set(y,L),h=L}d>0&&S(B())}if(p)d===0&&a&&(v=H(()=>a(s)));else if(ce()){var R=new Set,m=I;for(_=0;_<d;_+=1){b=k[_],y=l(b,_);var A=t.items.get(y)??C.get(y);A?j(A,b,_):(L=V(null,t,null,null,b,y,_,o,n,r,!0),C.set(y,L)),R.add(y)}for(const[M,N]of t.items)R.has(M)||m.skipped_effects.add(N.e);m.add_callback(c)}else c();T&&U(!0),Y(i)}),p&&(s=Q)}function Re(e,n,r,l,o,a,s,t,u){var v=n.length,w=r.items,C=r.first,i=C,k,f=null,c=[],d=[],T,E,h,L;for(L=0;L<v;L+=1){if(T=n[L],E=t(T,L),h=w.get(E),h===void 0){var _=l.get(E);if(_!==void 0){l.delete(E),w.set(E,_);var b=f?f.next:i;g(r,f,_),g(r,_,b),D(_,b,o),f=_}else{var y=i?i.e.nodes_start:o;f=V(y,r,f,f===null?r.first:f.next,T,E,L,a,s,u)}w.set(E,f),c=[],d=[],i=f.next;continue}if(j(h,T,L),(h.e.f&x)!==0&&W(h.e),h!==i){if(k!==void 0&&k.has(h)){if(c.length<d.length){var R=d[0],m;f=R.prev;var A=c[0],M=c[c.length-1];for(m=0;m<c.length;m+=1)D(c[m],R,o);for(m=0;m<d.length;m+=1)k.delete(d[m]);g(r,A.prev,M.next),g(r,f,A),g(r,M,R),i=R,f=M,L-=1,c=[],d=[]}else k.delete(h),D(h,i,o),g(r,h.prev,h.next),g(r,h,f===null?r.first:f.next),g(r,f,h),f=h;continue}for(c=[],d=[];i!==null&&i.k!==E;)(i.e.f&x)===0&&(k??=new Set).add(i),d.push(i),i=i.next;if(i===null)continue;h=i}c.push(h),f=h,i=h.next}if(i!==null||k!==void 0){for(var N=k===void 0?[]:z(k);i!==null;)(i.e.f&x)===0&&N.push(i),i=i.next;var q=N.length;if(q>0){var ee=v===0?o:null;Te(r,N,ee)}}e.first=r.first&&r.first.e,e.last=f&&f.e;for(var re of l.values())Z(re.e);l.clear()}function j(e,n,r,l){ve(e.v,n),e.i=r}function V(e,n,r,l,o,a,s,t,u,v,w){var C=(u&ke)!==0,i=(u&we)===0,k=C?i?ue(o,!1,!1):J(o):o,f=(u&_e)===0?s:J(s),c={i:f,v:k,k:a,a:null,e:null,prev:r,next:l};try{if(e===null){var d=document.createDocumentFragment();d.append(e=X())}return c.e=H(()=>t(e,k,f,v),p),c.e.prev=r&&r.e,c.e.next=l&&l.e,r===null?w||(n.first=c):(r.next=c,r.e.next=c.e),l!==null&&(l.prev=c,l.e.prev=c.e),c}finally{}}function D(e,n,r){for(var l=e.next?e.next.e.nodes_start:r,o=n?n.e.nodes_start:r,a=e.e.nodes_start;a!==null&&a!==l;){var s=Le(a);o.before(a),a=s}}function g(e,n,r){n===null?e.first=r:(n.next=r,n.e.next=r&&r.e),r!==null&&(r.prev=n,r.e.prev=n&&n.e)}function Ne(e,n,r=n){var l=new WeakSet;$(e,"input",async o=>{var a=o?e.defaultValue:e.value;if(a=F(e)?O(a):a,r(a),I!==null&&l.add(I),await ge(),a!==(a=n())){var s=e.selectionStart,t=e.selectionEnd;e.value=a??"",t!==null&&(e.selectionStart=s,e.selectionEnd=Math.min(t,e.value.length))}}),(p&&e.defaultValue!==e.value||G(n)==null&&e.value)&&(r(F(e)?O(e.value):e.value),I!==null&&l.add(I)),K(()=>{var o=n();if(e===document.activeElement){var a=be??I;if(l.has(a))return}F(e)&&o===O(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function Qe(e,n,r=n){$(e,"change",l=>{var o=l?e.defaultChecked:e.checked;r(o)}),(p&&e.defaultChecked!==e.checked||G(n)==null)&&r(e.checked),K(()=>{var l=n();e.checked=!!l})}function F(e){var n=e.type;return n==="number"||n==="range"}function O(e){return e===""?null:+e}function P(e){return{...e,clicks:e.clickCount}}const Ie=()=>{const{subscribe:e,set:n,update:r}=pe({links:[],filteredLinks:[],isLoading:!1,searchQuery:""});return{subscribe:e,loadLinks:async l=>{try{r(s=>({...s,isLoading:!0}));const o=await fetch("/api/links",{credentials:"include"}),a=await o.json();if(o.ok){const t=(a.links||[]).map(P);r(u=>({...u,links:t,filteredLinks:t,isLoading:!1}))}else{const s=a;throw new Error(s.error?.message||"Failed to load links")}}catch(o){console.error("Failed to load links:",o),r(a=>({...a,links:[],filteredLinks:[],isLoading:!1}))}},shortenUrl:async(l,o)=>{try{const a=await fetch("/api/shorten",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({url:l})}),s=await a.json();if(a.ok){const t=s;console.log("API Response:",t);const u=P(t);return console.log("Transformed Link:",u),r(v=>{const w=[u,...v.links];return{...v,links:w,filteredLinks:v.searchQuery?w.filter(C=>C.originalUrl.toLowerCase().includes(v.searchQuery.toLowerCase())||C.shortCode.toLowerCase().includes(v.searchQuery.toLowerCase())):w}}),u}else{const t=s;throw new Error(t.error?.message||"Failed to shorten URL")}}catch(a){throw console.error("Failed to shorten URL:",a),a}},deleteLink:async(l,o)=>{try{const a=await fetch(`/api/links/${l}`,{method:"DELETE",credentials:"include"});if(a.ok)r(s=>{const t=s.links.filter(u=>u.shortCode!==l);return{...s,links:t,filteredLinks:t.filter(u=>s.searchQuery?u.originalUrl.toLowerCase().includes(s.searchQuery.toLowerCase())||u.shortCode.toLowerCase().includes(s.searchQuery.toLowerCase()):!0)}});else{const s=await a.json();throw new Error(s.error?.message||"Failed to delete link")}}catch(a){throw console.error("Failed to delete link:",a),a}},searchLinks:l=>{r(o=>{const a=l?o.links.filter(s=>s.originalUrl.toLowerCase().includes(l.toLowerCase())||s.shortCode.toLowerCase().includes(l.toLowerCase())||s.shortUrl&&s.shortUrl.toLowerCase().includes(l.toLowerCase())):o.links;return{...o,searchQuery:l,filteredLinks:a}})},clear:()=>{n({links:[],filteredLinks:[],isLoading:!1,searchQuery:""})}}},Se=Ie();export{Qe as a,Ne as b,Me as e,Se as l};
